!function (e) {
    var n = !!~navigator.userAgent.indexOf(" AppleWebKit/");
    e.fn.console = function (o) {
        function t() {
            Q = 0, R = "", Y = 0, g(), K = e('<div class="jquery-console-prompt-box"></div>');
            var n = e('<span class="jquery-console-prompt-label"></span>'), o = E.continuedPrompt ? W : N;
            K.append(n.text(o).show()), n.html(n.html().replace(" ", "&nbsp;")), k = e('<span class="jquery-console-prompt"></span>'), K.append(k), L.append(K), w()
        }

        function r(e) {
            return (e.keyCode == A.tab || 192 == e.keyCode) && e.altKey
        }

        function s(e) {
            if (0 != X.length) {
                (Y += e) < 0 ? Y = X.length : Y > X.length && (Y = 0);
                R = 0 == Y ? V : X[Y - 1], o.historyPreserveColumn ? R.length < Q + 1 ? Q = R.length : 0 == Q && (Q = R.length) : Q = R.length, w()
            }
        }

        function i() {
            s(-1)
        }

        function c() {
            s(1)
        }

        function a(e) {
            X.push(e), V = ""
        }

        function l() {
            return Q < R.length && (R = R.substring(0, Q) + R.substring(Q + 1), V = R, !0)
        }

        function u() {
            l() && w()
        }

        function f() {
            var e = jQuery.fn.jquery.split("."), n = parseInt(e[0]), o = parseInt(e[1]);
            1 == n && o > 6 || n > 1 ? L.prop({scrollTop: L.prop("scrollHeight")}) : L.attr({scrollTop: L.attr("scrollHeight")})
        }

        function p() {
            "function" == typeof o.cancelHandle && o.cancelHandle()
        }

        function d() {
            if ("function" == typeof o.commandHandle) {
                h(), a(R);
                var e = R;
                E.continuedPrompt ? z ? z += "\n" + R : z = R : z = void 0, z && (e = z);
                var n = o.commandHandle(e, function (e) {
                    v(e)
                });
                E.continuedPrompt && !z && (z = R), "boolean" == typeof n ? n ? v() : v("Command failed.", "jquery-console-message-error") : "string" == typeof n ? v(n, "jquery-console-message-success") : "object" == typeof n && n.length ? v(n) : E.continuedPrompt && v()
            }
        }

        function h() {
            D = !1
        }

        function g() {
            D = !0
        }

        function v(n, o) {
            if (Q = -1, w(), "string" == typeof n) m(n, o); else if (e.isArray(n)) for (var r in n) {
                var s = n[r];
                m(s.msg, s.className)
            } else L.append(n);
            t()
        }

        function m(n, o) {
            var t = e('<div class="jquery-console-message"></div>');
            o && t.addClass(o), t.filledText(n).hide(), L.append(t), t.show()
        }

        function y(e) {
            return Q + e >= 0 && Q + e <= R.length && (Q += e, !0)
        }

        function b() {
            return !!y(1) && (w(), !0)
        }

        function C() {
            return !!y(-1) && (w(), !0)
        }

        function j() {
            y(-Q) && w()
        }

        function q() {
            y(R.length - Q) && w()
        }

        function x(e) {
            if ("string" == typeof e) {
                var n = e.charCodeAt();
                return n >= "A".charCodeAt() && n <= "Z".charCodeAt() || n >= "a".charCodeAt() && n <= "z".charCodeAt() || n >= "0".charCodeAt() && n <= "9".charCodeAt()
            }
            return !1
        }

        function w() {
            var e = R, n = "";
            if (Q > 0 && "" == e) n = P; else if (Q == R.length) n = T(e) + P; else {
                var o = e.substring(0, Q), t = e.substring(Q, Q + 1);
                t && (t = '<span class="jquery-console-cursor">' + T(t) + "</span>");
                var r = e.substring(Q + 1);
                n = T(o) + t + T(r)
            }
            k.html(n), f()
        }

        function T(e) {
            return e.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/</g, "&lt;").replace(/ /g, "&nbsp;").replace(/\n/g, "<br />")
        }

        var A = {
            37: C, 39: b, 38: i, 40: c, 8: function () {
                y(-1) && (l(), w())
            }, 46: u, 35: q, 36: j, 13: function () {
                var e = R;
                if ("function" == typeof o.commandValidate) {
                    var n = o.commandValidate(e);
                    1 == n || 0 == n ? n && d() : v(n, "jquery-console-message-error")
                } else d()
            }, 18: function () {
            }, 9: function () {
                if ("function" == typeof o.completeHandle) {
                    var e = o.completeHandle(R), n = e.length;
                    if (1 === n) E.promptText(R + e[0]); else if (n > 1 && o.cols) {
                        for (var t = R, r = 0, s = 0; s < n; s++) r = Math.max(r, e[s].length);
                        r += 2;
                        var i = Math.floor(o.cols / r), c = "", a = 0;
                        for (s = 0; s < n; s++) {
                            var l = e[s];
                            c += e[s];
                            for (var u = l.length; u < r; u++) c += " ";
                            ++a >= i && (c += "\n", a = 0)
                        }
                        v(c, "jquery-console-message-value"), E.promptText(t)
                    }
                }
            }
        }, I = {
            65: j, 69: q, 68: u, 78: c, 80: i, 66: C, 70: b, 75: function () {
                for (; l();) w()
            }
        };
        o.ctrlCodes && e.extend(I, o.ctrlCodes);
        var K, k, H = {
                70: function () {
                    for (; Q < R.length && !x(R[Q]) && b();) ;
                    for (; Q < R.length && x(R[Q]) && b();) ;
                }, 66: function () {
                    for (; Q - 1 >= 0 && !x(R[Q - 1]) && C();) ;
                    for (; Q - 1 >= 0 && x(R[Q - 1]) && C();) ;
                }, 68: function () {
                    for (; Q < R.length && !x(R[Q]);) l(), w();
                    for (; Q < R.length && x(R[Q]);) l(), w()
                }
            }, O = {
                13: function () {
                    R += "\n", y(1), w()
                }
            }, P = '<span class="jquery-console-cursor">&nbsp;</span>', S = e(this), L = e('<div class="jquery-console-inner"></div>'), M = e('<textarea class="jquery-console-typer"></textarea>'),
            N = o && o.promptLabel ? o.promptLabel : "> ", W = o && o.continuedPromptLabel ? o.continuedPromptLabel : "> ", Q = 0, R = "", V = "", z = "",
            B = void 0 === o.fadeOnReset || o.fadeOnReset, X = [], Y = 0, Z = 0, D = !0, E = {};
        return S.append(L), L.append(M), M.css({
            position: "absolute",
            top: 0,
            left: "-9999px"
        }), o.welcomeMessage && m(o.welcomeMessage, "jquery-console-welcome"), t(), o.autofocus && (L.addClass("jquery-console-focus"), M.focus(), setTimeout(function () {
            L.addClass("jquery-console-focus"), M.focus()
        }, 100)), E.inner = L, E.typer = M, E.scrollToBottom = f, E.reset = function () {
            var n = void 0 !== o.welcomeMessage, r = function () {
                L.find("div").each(function () {
                    n ? n = !1 : e(this).remove()
                })
            }, s = function () {
                L.addClass("jquery-console-focus"), M.focus()
            };
            B ? L.parent().fadeOut(function () {
                r(), t(), L.parent().fadeIn(s)
            }) : (r(), t(), s())
        }, E.notice = function (n, o) {
            var t = e('<div class="notice"></div>').append(e("<div></div>").text(n)).css({visibility: "hidden"});
            S.append(t);
            var r = !0;
            if ("fadeout" == o) setTimeout(function () {
                t.fadeOut(function () {
                    t.remove()
                })
            }, 4e3); else if ("prompt" == o) {
                var s = e('<br/><div class="action"><a href="javascript:">OK</a><div class="clear"></div></div>');
                t.append(s), r = !1, s.click(function () {
                    t.fadeOut(function () {
                        t.remove(), L.css({opacity: 1})
                    })
                })
            }
            var i = t.height();
            return t.css({height: "0px", visibility: "visible"}).animate({height: i + "px"}, function () {
                r || L.css({opacity: .5})
            }), t.css("cursor", "default"), t
        }, S.click(function () {
            return !window.getSelection().toString() && (L.addClass("jquery-console-focus"), L.removeClass("jquery-console-nofocus"), n ? M.focusWithoutScrolling() : M.css("position", "fixed").focus(), f(), !1)
        }), M.blur(function () {
            L.removeClass("jquery-console-focus"), L.addClass("jquery-console-nofocus")
        }), M.bind("paste", function (e) {
            M.val(""), setTimeout(function () {
                M.consoleInsert(M.val()), M.val("")
            }, 0)
        }), M.keydown(function (e) {
            Z = 0;
            var n = e.keyCode;
            if (e.ctrlKey && 67 == n) return Z = n, p(), !1;
            if (D) {
                if (e.shiftKey && n in O) return Z = n, O[n](), !1;
                if (e.altKey && n in H) return Z = n, H[n](), !1;
                if (e.ctrlKey && n in I) return Z = n, I[n](), !1;
                if (n in A) return Z = n, A[n](), !1
            }
        }), M.keypress(function (e) {
            var t = e.keyCode || e.which;
            if (r(e)) return !1;
            if ((e.ctrlKey || e.metaKey) && "v" == String.fromCharCode(t).toLowerCase()) return !0;
            if (D && Z != t && t >= 32) {
                if (Z) return !1;
                (void 0 === o.charInsertTrigger || "function" == typeof o.charInsertTrigger && o.charInsertTrigger(t, R)) && M.consoleInsert(t)
            }
            return !n && void 0
        }), M.consoleInsert = function (e) {
            var n = isNaN(e) ? e : String.fromCharCode(e), o = R.substring(0, Q), t = R.substring(Q);
            R = o + n + t, y(n.length), V = R, w()
        }, E.promptText = function (e) {
            return "string" == typeof e && (Q = (R = e).length, w()), R
        }, E
    }, e.fn.filledText = function (n) {
        return e(this).text(n), e(this).html(e(this).html().replace(/\n/g, "<br/>")), this
    }, e.fn.focusWithoutScrolling = function () {
        var n = window.scrollX, o = window.scrollY;
        e(this).focus(), window.scrollTo(n, o)
    }
}(jQuery);